{% load static %} {% if user.is_authenticated %}
<div
  id="drawer-navigation"
  class="fixed top-0 left-0 z-40 w-64 h-screen p-4 overflow-y-auto transition-transform -translate-x-full bg-gray-900"
  tabindex="-1"
  aria-labelledby="drawer-navigation-label"
>
  <h5
    id="drawer-navigation-label"
    class="text-base font-semibold uppercase text-gray-400"
  >
    Menu
  </h5>
  <button
    type="button"
    data-drawer-hide="drawer-navigation"
    aria-controls="drawer-navigation"
    class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 absolute top-2.5 end-2.5 inline-flex items-center"
  >
    <svg
      aria-hidden="true"
      class="w-5 h-5"
      fill="currentColor"
      viewBox="0 0 20 20"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        fill-rule="evenodd"
        d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
        clip-rule="evenodd"
      ></path>
    </svg>
    <span class="sr-only">Cerrar menú</span>
  </button>
  <div class="py-4 overflow-y-auto">
    <ul class="space-y-2 font-medium">
      <li>
        <a
          href="{% url 'dashboard' %}"
          class="flex items-center p-2 rounded-lg text-white hover:bg-gray-600 group"
        >
          <svg
            class="w-5 h-5 transition duration-75 text-white group-hover:text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="currentColor"
            viewBox="0 0 22 21"
          >
            <path
              d="M16.975 11H10V4.025a1 1 0 0 0-1.066-.998 8.5 8.5 0 1 0 9.039 9.039.999.999 0 0 0-1-1.066h.002Z"
            ></path>
            <path
              d="M12.5 0c-.157 0-.311.01-.565.027A1 1 0 0 0 11 1.02V10h8.975a1 1 0 0 0 1-.935c.013-.188.028-.374.028-.565A8.51 8.51 0 0 0 12.5 0Z"
            ></path>
          </svg>
          <span class="ms-3">Dashboard</span>
        </a>
      </li>
      <li>
        <button
          type="button"
          class="flex items-center w-full p-2 text-base transition duration-75 rounded-lg group text-white hover:bg-gray-600"
          aria-controls="dropdown-example"
          data-collapse-toggle="dropdown-example"
        >
          <svg
            class="flex-shrink-0 w-5 h-5 text-white transition duration-75 group-hover:text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              fill-rule="evenodd"
              d="M3 6c0-1.1.9-2 2-2h5.5a2 2 0 0 1 1.6.7L14 7H3V6Zm0 3v10c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V9H3Z"
              clip-rule="evenodd"
            ></path>
          </svg>
          <span class="flex-1 ms-3 text-left rtl:text-right whitespace-nowrap"
            >Grupos</span
          >
          <svg
            class="w-3 h-3"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 10 6"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="m1 1 4 4 4-4"
            ></path>
          </svg>
        </button>
        <ul id="dropdown-example" class="hidden py-2 space-y-2">
          {% for project in projects %}

          <li>
            <a
              href="{% url 'proyecto' project.id %}"
              class="flex items-center w-full p-2 text-white transition duration-75 rounded-lg pl-11 group hover:bg-gray-600"
              >{{ project.name }}
            </a>
          </li>
          {% endfor %}
        </ul>
      </li>
      <li>
        <button
          type="button"
          class="flex items-center w-full p-2 text-base text-white transition duration-75 rounded-lg group hover:bg-gray-600"
          aria-controls="dropdown-tasks"
          data-collapse-toggle="dropdown-tasks"
        >
          <svg
            class="flex-shrink-0 w-5 h-5 text-white transition duration-75 group-hover:text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              fill-rule="evenodd"
              d="M3 6c0-1.1.9-2 2-2h5.5a2 2 0 0 1 1.6.7L14 7H3V6Zm0 3v10c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V9H3Z"
              clip-rule="evenodd"
            ></path>
          </svg>
          <span class="flex-1 ms-3 text-left rtl:text-right whitespace-nowrap"
            >Tareas activas</span
          >
          <svg
            class="w-3 h-3"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 10 6"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="m1 1 4 4 4-4"
            ></path>
          </svg>
        </button>
        <ul id="dropdown-tasks" class="hidden py-2 space-y-2">
          {% for task in tasksAsigned%}
          <li>
            <a
              href="{% url 'proyecto' task.id %}"
              class="flex items-center w-full p-2 text-white transition duration-75 rounded-lg pl-11 group hover:bg-gray-600"
              >{{task.tarea}}
            </a>
          </li>
          {% endfor %}
        </ul>
      </li>
      <li>
        <a
          href="#"
          class="flex items-center p-2 text-white rounded-lg hover:bg-gray-600 group"
        >
          <svg
            class="flex-shrink-0 w-5 h-5 text-white transition duration-75 group-hover:text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              d="m17.418 3.623-.018-.008a6.713 6.713 0 0 0-2.4-.569V2h1a1 1 0 1 0 0-2h-2a1 1 0 0 0-1 1v2H9.89A6.977 6.977 0 0 1 12 8v5h-2V8A5 5 0 1 0 0 8v6a1 1 0 0 0 1 1h8v4a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-4h6a1 1 0 0 0 1-1V8a5 5 0 0 0-2.582-4.377ZM6 12H4a1 1 0 0 1 0-2h2a1 1 0 0 1 0 2Z"
            ></path>
          </svg>
          <span class="flex-1 ms-3">Inbox</span>
          <span
            class="inline-flex items-center justify-center w-3 h-3 p-3 ms-3 text-sm font-medium text-blue-800 bg-blue-100 rounded-full"
            >3</span
          >
        </a>
      </li>
    </ul>
  </div>
</div>
<div class="px-4 py-4 lg:px-6 lg:pl-4" data-astro-cid-mo56jcke>
  <div class="flex items-center justify-between" data-astro-cid-mo56jcke>
    <div class="flex items-center justify-start" data-astro-cid-mo56jcke>
      <svg
        class="w-8 h-8 text-gray-600 cursor-pointer"
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        data-drawer-target="drawer-navigation"
        data-drawer-show="drawer-navigation"
        aria-controls="drawer-navigation"
        data-astro-cid-mo56jcke
      >
        <path
          stroke="currentColor"
          stroke-linecap="round"
          stroke-width="2"
          d="M5 7h14M5 12h14M5 17h10"
          data-astro-cid-mo56jcke
        ></path>
      </svg>
    </div>
    <div class="flex items-center justify-center" data-astro-cid-mo56jcke>
      <a
        href="/"
        class="self-center text-xl font-semibold sm:text-2xl whitespace-nowrap text-white"
        data-astro-cid-mo56jcke
        >Scrum Manager</a
      >
    </div>
    <div class="flex items-center" data-astro-cid-mo56jcke>
      <div class="hidden mr-3 -mb-1 sm:block" data-astro-cid-mo56jcke>
        <span data-astro-cid-mo56jcke></span>
      </div>
      <!-- Notifications -->
      <button
        type="button"
        data-dropdown-toggle="notification-dropdown"
        class="p-2 text-gray-500 rounded-lg hover:text-gray-900 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-700"
        data-astro-cid-mo56jcke
      >
        <span class="sr-only" data-astro-cid-mo56jcke>View notifications</span>
        <!-- Bell icon -->
        <svg
          class="w-6 h-6"
          fill="currentColor"
          viewBox="0 0 20 20"
          xmlns="http://www.w3.org/2000/svg"
          data-astro-cid-mo56jcke
        >
          <path
            d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"
            data-astro-cid-mo56jcke
          ></path></svg
        >
        <!-- If para comprobar que hay notificaciones -->
         {% if notifications %}
        <span
          class="absolute top-9 rounded-full bg-red-700 border-2 border-black h-4 w-4"
          data-astro-cid-mo56jcke
        ></span>
        {% endif %}
        <!-- NOTIFICACION EN EL BELL ICON -->
      </button>
      <!-- Dropdown menu -->
      <div
        class="[box-shadow:2px_2px_10px_20px_rgba(20,20,20,0.5);] z-50 hidden max-w-sm my-12 overflow-hidden text-base list-none divide-y rounded shadow-lg divide-gray-700 bg-gray-900 notif"
        id="notification-dropdown"
        data-popper-placement="bottom"
        style="position: absolute; inset: 20px; margin: 10px"
        data-astro-cid-mo56jcke
      >
        <div
          class="block px-4 py-2 text-base font-medium text-center bg-gray-900 text-gray-400"
          data-astro-cid-mo56jcke
        >
          Notificaciones
        </div>
        {% if notifications %}
          {% for notification in notifications%}
          <div class="flex w-full notification-{{notification.id}}">
            <div class="p-5 w-10/12">
              <div class="font-normal text-sm mb-1.5 text-gray-400">
                {{notification.message}}
              </div>
              <div class="text-xs font-medium text-cyan-400">
                {{notification.date}}
              </div>
            </div>
            <div class="w-2/12 flex items-center">
              <button onclick="markAsRead({{notification.id}})">
                <svg class="w-6 h-6 hover:text-gray-600 text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                  <path fill-rule="evenodd" d="M4.998 7.78C6.729 6.345 9.198 5 12 5c2.802 0 5.27 1.345 7.002 2.78a12.713 12.713 0 0 1 2.096 2.183c.253.344.465.682.618.997.14.286.284.658.284 1.04s-.145.754-.284 1.04a6.6 6.6 0 0 1-.618.997 12.712 12.712 0 0 1-2.096 2.183C17.271 17.655 14.802 19 12 19c-2.802 0-5.27-1.345-7.002-2.78a12.712 12.712 0 0 1-2.096-2.183 6.6 6.6 0 0 1-.618-.997C2.144 12.754 2 12.382 2 12s.145-.754.284-1.04c.153-.315.365-.653.618-.997A12.714 12.714 0 0 1 4.998 7.78ZM12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" clip-rule="evenodd"/>
                </svg>
                    
            </button>      
            </div>
          </div>
          {% endfor %}
        {% else %}
          <div class="p-5 text-center text-gray-400">No tienes notificaciones pendientes de revisar. ¡Estás al día!</div>
        {% endif %}
      </div>
      <div class="flex items-center ml-3" data-astro-cid-mo56jcke>
        <div data-astro-cid-mo56jcke>
          <button
            type="button"
            class="flex text-sm bg-gray-800 rounded-full focus:ring-4 focus:ring-gray-300"
            id="user-menu-button-2"
            aria-expanded="false"
            data-dropdown-toggle="dropdown-2"
            data-astro-cid-mo56jcke
          >
            <span class="sr-only" data-astro-cid-mo56jcke
              >Abrir menu de usuario</span
            >
            <img
              class="w-8 h-8 rounded-full"
              src="{% static 'img/perfil.png' %}"
              alt="user photo"
              data-astro-cid-mo56jcke
            />
          </button>
        </div>
        <!-- Dropdown menu -->
        <div
          class="[box-shadow:2px_2px_10px_20px_rgba(20,20,20,0.5);] z-50 hidden my-4 text-base list-none bg-gray-900 divide-y divide-gray-600 rounded shadow"
          id="dropdown-2"
          data-popper-placement="bottom"
          style="
            position: absolute;
            inset: 0px auto auto 0px;
            margin: 0px;
            transform: translate3d(1483.2px, 60.8px, 0px);
          "
          data-astro-cid-mo56jcke
        >
          <div class="px-4 py-3" role="none" data-astro-cid-mo56jcke>
            <p class="text-sm text-white" role="none" data-astro-cid-mo56jcke>
              {{user.username}}
            </p>
            <p
              class="text-sm font-medium text-gray-300 truncate"
              role="none"
              data-astro-cid-mo56jcke
            >
              {{user}}
            </p>
          </div>
          <ul class="py-1" role="none" data-astro-cid-mo56jcke>
            <li data-astro-cid-mo56jcke>
              <a
                href="{% url 'logout' %}"
                class="block px-4 py-2 text-sm text-white hover:bg-gray-600"
                role="menuitem"
                data-astro-cid-mo56jcke
                >Cerrar sesión</a
              >
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- drawer component -->
<div
  id="drawer-navigation"
  class="fixed top-0 left-0 z-40 w-64 h-screen p-4 overflow-y-auto transition-transform -translate-x-full bg-gray-900"
  tabindex="-1"
  aria-labelledby="drawer-navigation-label"
>
  <h5
    id="drawer-navigation-label"
    class="text-base font-semibold uppercase text-gray-400"
  >
    Menu
  </h5>
  <button
    type="button"
    data-drawer-hide="drawer-navigation"
    aria-controls="drawer-navigation"
    class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 absolute top-2.5 end-2.5 inline-flex items-center"
  >
    <svg
      aria-hidden="true"
      class="w-5 h-5"
      fill="currentColor"
      viewBox="0 0 20 20"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        fill-rule="evenodd"
        d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
        clip-rule="evenodd"
      ></path>
    </svg>
    <span class="sr-only">Cerrar menú</span>
  </button>
</div>
{% else %}
<div class="px-4 py-4 lg:px-6 lg:pl-4">
  <div class="flex items-center justify-between">
    <div class="flex items-center justify-start">
      <a href="/" class="flex ml-2 md:mr-24">
        <img
          src="{% static 'img/logoScrumManager.svg' %}"
          class="h-8 mr-3"
          alt="ScrumManager Logo"
        />
        <span
          class="self-center text-xl font-semibold sm:text-2xl whitespace-nowrap text-white hidden sm:block"
          >Scrum Manager</span
        >
      </a>
    </div>
    <!-- Profile -->
    <div class="flex items-center ml-3">
      <div
        class="mr-2 p-2 rounded-lg text-gray-400 hover:text-white hover:bg-gray-700"
      >
        <a href="/login" class="text-gray-400 font-bold">Iniciar sesión</a>
      </div>
      <div
        class="mx-1 p-2 text-gray-800 bg-slate-100 rounded-lg hover:bg-gray-500 hover:text-gray-100"
      >
        <a href="/register" class="font-bold">Registrarse</a>
      </div>
    </div>
  </div>
</div>

{% endif %}

<script>
  function markAsRead(id) {
    fetch(`/mark_as_read/${id}/`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": "{{ csrf_token }}",
      },
    }).then((response) => {
      if (response.ok) {
        console.log("Notificación marcada como leída");
        // Eliminar la notificación de la lista
        document.querySelector(`.notification-${id}`).remove();
        // Actualizar el contador de notificaciones en el icono de la campana
      }
    });
  }
</script>
